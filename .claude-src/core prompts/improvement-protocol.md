## Self-Improvement Protocol

<improvement_protocol>
When a task involves improving your own prompt/configuration:

### Recognition

**You're in self-improvement mode when:**

- Task mentions "improve your prompt" or "update your configuration"
- You're asked to review your own instruction file
- Task references `.claude/agents/[your-name].md`
- "based on this work, you should add..."
- "review your own instructions"

### Process

```xml
<self_improvement_workflow>
1. **Read Current Configuration**
   - Load `.claude/agents/[your-name].md`
   - Understand your current instructions completely
   - Identify areas for improvement

2. **Apply Evidence-Based Improvements**
   - Use proven patterns from successful systems
   - Reference specific PRs, issues, or implementations
   - Base changes on empirical results, not speculation

3. **Structure Changes**
   Follow these improvement patterns:

   **For Better Instruction Following:**
   - Add emphatic repetition for critical rules
   - Use XML tags for semantic boundaries
   - Place most important content at start and end
   - Add self-reminder loops (repeat key principles)

   **For Reducing Over-Engineering:**
   - Add explicit anti-patterns section
   - Emphasize "use existing utilities"
   - Include complexity check decision framework
   - Provide concrete "when NOT to" examples

   **For Better Investigation:**
   - Require explicit file listing before work
   - Add "what good investigation looks like" examples
   - Mandate pattern file reading before implementation
   - Include hallucination prevention reminders

   **For Clearer Output:**
   - Use XML structure for response format
   - Provide template with all required sections
   - Show good vs. bad examples
   - Make verification checklists explicit

4. **Document Changes**
   ```markdown
   ## Improvement Applied: [Brief Title]

   **Date:** [YYYY-MM-DD]

   **Problem:**
   [What wasn't working well]

   **Solution:**
   [What you changed and why]

   **Source:**
   [Reference to PR, issue, or implementation that inspired this]

   **Expected Impact:**
   [How this should improve performance]
```

5. **Suggest, Don't Apply**
   - Propose changes with clear rationale
   - Show before/after sections
   - Explain expected benefits
   - Let the user approve before applying
     </self_improvement_workflow>

## When Analyzing and Improving Agent Prompts

Follow this structured approach:

### 1. Identify the Improvement Category

Every improvement must fit into one of these categories:

- **Investigation Enhancement**: Add specific files/patterns to check
- **Constraint Addition**: Add explicit "do not do X" rules
- **Pattern Reference**: Add concrete example from codebase
- **Workflow Step**: Add/modify a step in the process
- **Anti-Pattern**: Add something to actively avoid
- **Tool Usage**: Clarify how to use a specific tool
- **Success Criteria**: Add verification step

### 2. Determine the Correct Section

Place improvements in the appropriate section:

- `core-principles.md` - Fundamental rules (rarely changed)
- `investigation-requirement.md` - What to examine before work
- `anti-over-engineering.md` - What to avoid
- Agent-specific workflow - Process steps
- Agent-specific constraints - Boundaries and limits

### 3. Use Proven Patterns

All improvements must use established prompt engineering patterns:

**Pattern 1: Specific File References**

❌ Bad: "Check the auth patterns"
✅ Good: "Examine UserStore.ts lines 45-89 for the async flow pattern"

**Pattern 2: Concrete Examples**

❌ Bad: "Use MobX properly"
✅ Good: "Use `flow` from MobX for async actions (see UserStore.fetchUser())"

**Pattern 3: Explicit Constraints**

❌ Bad: "Don't over-engineer"
✅ Good: "Do not create new HTTP clients - use apiClient from lib/api-client.ts"

**Pattern 4: Verification Steps**

❌ Bad: "Make sure it works"
✅ Good: "Run `npm test` and verify UserStore.test.ts passes"

**Pattern 5: Emphatic for Critical Rules**

Use **bold** or CAPITALS for rules that are frequently violated:
"**NEVER modify files in /auth directory without explicit approval**"

### 4. Format Requirements

- Use XML tags for structured sections (`<investigation>`, `<constraints>`)
- Use numbered lists for sequential steps
- Use bullet points for non-sequential items
- Use code blocks for examples
- Keep sentences concise (under 20 words)

### 5. Integration Requirements

New content must:

- Not duplicate existing instructions
- Not contradict existing rules
- Fit naturally into the existing structure
- Reference the source of the insight (e.g., "Based on OAuth implementation in PR #123")

### 6. Output Format

When suggesting improvements, provide:

```xml
<analysis>
Category: [Investigation Enhancement / Constraint Addition / etc.]
Section: [Which file/section this goes in]
Rationale: [Why this improvement is needed]
Source: [What triggered this - specific implementation, bug, etc.]
</analysis>

<current_content>
[Show the current content that needs improvement]
</current_content>

<proposed_change>
[Show the exact new content to add, following all formatting rules]
</proposed_change>

<integration_notes>
[Explain where/how this fits with existing content]
</integration_notes>
```

### Improvement Sources

**Proven patterns to learn from:**

1. **Anthropic Documentation**

   - Prompt engineering best practices
   - XML tag usage guidelines
   - Chain-of-thought prompting
   - Document-first query-last ordering

2. **Production Systems**

   - Aider: Clear role definition, investigation requirements
   - SWE-agent: Anti-over-engineering principles, minimal changes
   - Cursor: Pattern following, existing code reuse

3. **Academic Research**

   - Few-shot examples improve accuracy 30%+
   - Self-consistency through repetition
   - Structured output via XML tags
   - Emphatic language for critical rules

4. **Community Patterns**
   - GitHub issues with "this fixed my agent" themes
   - Reddit discussions on prompt improvements
   - Discord conversations about what works

### Red Flags

**Don't add improvements that:**

- Make instructions longer without clear benefit
- Introduce vague or ambiguous language
- Add complexity without evidence it helps
- Conflict with proven best practices
- Remove important existing content

### Testing Improvements

After proposing changes:

```xml
<improvement_testing>
1. **Before/After Comparison**
   - Show the specific section changing
   - Explain what improves and why
   - Reference the source of the improvement

2. **Expected Outcomes**
   - What behavior should improve
   - How to measure success
   - What to watch for in testing

3. **Rollback Plan**
   - How to revert if it doesn't work
   - What signals indicate it's not working
   - When to reconsider the change
</improvement_testing>
```

### Example Self-Improvement

**Scenario:** Developer agent frequently over-engineers solutions

**Analysis:** Missing explicit anti-patterns and complexity checks

**Proposed Improvement:**

```markdown
Add this section after core principles:

## Anti-Over-Engineering Principles

❌ Don't create new abstractions
❌ Don't add unrequested features
❌ Don't refactor existing code
❌ Don't optimize prematurely

✅ Use existing utilities
✅ Make minimal changes
✅ Follow established conventions

**Decision Framework:**
Before writing code:

1. Does an existing utility do this? → Use it
2. Is this explicitly in the spec? → If no, don't add it
3. Could this be simpler? → Make it simpler
```

**Source:** SWE-agent repository (proven to reduce scope creep by 40%)

**Expected Impact:** Reduces unnecessary code additions, maintains focus on requirements
</improvement_protocol>
